<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working with mirror data • comtradeRggregator</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Working with mirror data">
<meta property="og:description" content="comtradeRggregator">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">comtradeRggregator</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../articles/comtradeRggregator.html">Get started</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/articles/chaining-concordance-tables.html">Chaining concordance tables</a>
    </li>
    <li>
      <a href="../../articles/articles/extracting-aggregates.html">Extracting aggregated trade data</a>
    </li>
    <li>
      <a href="../../articles/articles/handling-errors.html">Handling error messages</a>
    </li>
    <li>
      <a href="../../articles/articles/mirror-data.html">Working with mirror data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/amannj/comtradeRggregator/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Mirror-data_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Working with mirror data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/amannj/comtradeRggregator/blob/master/vignettes/articles/mirror-data.Rmd"><code>vignettes/articles/mirror-data.Rmd</code></a></small>
      <div class="hidden name"><code>mirror-data.Rmd</code></div>

    </div>

    
    
<div id="why-use-mirror-data" class="section level2">
<h2 class="hasAnchor">
<a href="#why-use-mirror-data" class="anchor"></a>Why use mirror data?</h2>
<p>Sometimes trade data between countries do not “add up”: For example, in 2020 country A reported USD <span class="math inline">\(X\)</span> millions exports to country B while B was reporting USD <span class="math inline">\(Y\)</span> millions, where <span class="math inline">\(X \neq Y\)</span>; which data is more reliable? Alternatively, consider the case where country A does not report any trade data at all; we can use trade data from all trade partners of country A to reconstruct its ‘own’ trade data?</p>
<p>In such cases, it makes sense to use <a href="https://wits.worldbank.org/wits/wits/witshelp/Content/Data_Retrieval/T/Intro/B2.Imports_Exports_and_Mirror.htm">mirrored trade data</a>. The function <code><a href="../../reference/download_Comtrade.html">download_Comtrade()</a></code> offers an easy option to accomplish this. While <a href="https://amannj.github.io/resources/comtradeRggregator/articles/comtradeRggregator.html#example-4">Example 4</a> in the <em>Get Started guide</em> provides a simple introduction, a more complex example is discussed in this article.</p>
</div>
<div id="a-more-complex-example" class="section level2">
<h2 class="hasAnchor">
<a href="#a-more-complex-example" class="anchor"></a>A more complex example</h2>
<p>Let’s say you want to download monthly mirror trade data starting in 2019 at the HS 6-digit level for a handful of countries for which there is no trade data available on <a href="https://comtrade.un.org/">comtrade</a>.</p>
<p>While there are multiple areas where both <a href="https://comtrade.un.org/">comtrade</a> and <a href="https://wits.worldbank.org/">WITS</a> offer similar functionality to the <code>comtradeRggregator</code> package, this is a scenario where both alternatives are tedious to work with:</p>
<ul>
<li><p>While <a href="https://wits.worldbank.org/">WITS</a> does offer a straight-forward integration of mirror data, there are (at the time of writing this documentation in 2021) no options available to query monthly data;</p></li>
<li><p>While <a href="https://comtrade.un.org/">comtrade</a> does over the most recent and granular trade data, the options to query mirror data are not there.</p></li>
</ul>
<p>As I will demonstrate below, the same query can be run with little to no additional effort using <code>comtradeRggregator</code>.</p>
</div>
<div id="implementation" class="section level2">
<h2 class="hasAnchor">
<a href="#implementation" class="anchor"></a>Implementation</h2>
<p>First, load the package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/amannj/comtradeRggregator">comtradeRggregator</a></span><span class="op">)</span></code></pre></div>
<p>Next, we want to define list of countries for extraction. The two examples we use here are <em>Afghanistan</em> and the <em>Democratic Republic of the Congo</em>. To double-check the correct spelling of the country names we use <code><a href="../../reference/is.available_Comtrade.html">is.available_Comtrade()</a></code> with option <code>is.fuzzy = TRUE</code>. Below I run the check for the <em>Democratic Republic of the Congo</em> only. However, for large queries it is advisable to double-check that all country names are correct before setting up the actual data query. If you don’t do that, and are unlucky in the sense that a particular country name is spelled differently in <a href="https://comtrade.un.org/">comtrade</a>, your data query will return an error.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../../reference/is.available_Comtrade.html">is.available_Comtrade</a></span><span class="op">(</span>
  is.contained <span class="op">=</span> <span class="st">"Congo"</span>,
  is.fuzzy <span class="op">=</span> <span class="cn">TRUE</span>,
  frequency <span class="op">=</span> <span class="st">"annual"</span>,
  nomenclature <span class="op">=</span> <span class="st">"HS"</span>,
  year <span class="op">=</span> <span class="st">'2019'</span>
<span class="op">)</span>
<span class="co">#&gt; # A tibble: 2 x 2</span>
<span class="co">#&gt;   country                 year</span>
<span class="co">#&gt;   &lt;chr&gt;                  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Dem. Rep. of the Congo  2019</span>
<span class="co">#&gt; 2 Congo                   2019</span></code></pre></div>
<p>The final list of countries we want to query is:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">country_list</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Afghanistan"</span>, <span class="st">"Dem. Rep. of the Congo"</span><span class="op">)</span></code></pre></div>
<p>When setting up this more elaborate query, there are a few things we should keep in mind:</p>
<ul>
<li><p>It makes sense to break up this query into two parts: a download for the years 2019 and 2020, and a separate query for 2021. The reason for this is that at the time of writing this tutorial, trade data for all 12 months was available for 2019 and 2020, but not for 2021 as this would make <code><a href="../../reference/download_Comtrade.html">download_Comtrade()</a></code> throw an error message.</p></li>
<li><p>It is advisable to keep any temporarily downloaded data by setting <code>rm.temporaryFiles = FALSE</code>. I also want to save the temporary files in a different location specified in variable <code>my_location</code>, so I also specify <code>location.temporaryFiles = my_location</code> in the query below.</p></li>
<li><p>In an ideal world, you will have access to an authenticated account <a href="https://comtrade.un.org/data/doc/api/">(see here)</a>. I do, so I’m also providing my <a href="https://comtrade.un.org/">comtrade</a> authentication token as part of the query.</p></li>
<li><p>Note that for the first query we are not specifying the parameter <code>month</code> which, by default, will return data for all 12 months. Also, note that monthly <a href="https://comtrade.un.org/">comtrade</a> data is only available following the <em>HS combined nomenclature</em>.</p></li>
<li><p>Finally, as we do not want to overwhelm the API, we reduce the number of extracted countries per sub-query to three, i.e. <code>ext_cnt  = 3</code>, instead of the default of five, and increase the cool-down period between the separate queries from five to ten seconds between rounds by setting <code>speed = 10</code>. These last two steps are optional and only serve illustrative purposes.</p></li>
</ul>
<p>With all of this out of the way, the final monthly mirror data query for 2019 and 2020 looks like this:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mirr_part1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/download_Comtrade.html">download_Comtrade</a></span><span class="op">(</span>
  year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2019"</span>, <span class="st">"2020"</span><span class="op">)</span>,
  frequency <span class="op">=</span> <span class="st">"monthly"</span>,
  countries <span class="op">=</span> <span class="va">country_list</span>,
  partners <span class="op">=</span> <span class="st">"World"</span>,
  nomenclature <span class="op">=</span> <span class="st">"HS"</span>,
  commodity <span class="op">=</span> <span class="st">"ag6"</span>,
  select.stats <span class="op">=</span> <span class="st">"trade_value_usd"</span>,
  direction <span class="op">=</span> <span class="st">"all"</span>,
  type <span class="op">=</span> <span class="st">"commodities"</span>,
  is.mirrorData <span class="op">=</span> <span class="cn">TRUE</span>,
  rm.temporaryFiles <span class="op">=</span> <span class="cn">FALSE</span>,
  location.temporaryFiles <span class="op">=</span> <span class="va">my_location</span>,
  build.Comtrade <span class="op">=</span> <span class="cn">TRUE</span>,
  token <span class="op">=</span> <span class="va">my_token</span>,
  ext_cnt  <span class="op">=</span> <span class="fl">3</span>,
  sleep <span class="op">=</span> <span class="fl">10</span>
<span class="op">)</span></code></pre></div>
<p>For the 2021 query, we first want to find the last month of 2021 for which trade data is available. This makes sense because we do not want to run a query for a month where no trade data is available as this would make <code><a href="../../reference/download_Comtrade.html">download_Comtrade()</a></code> throw an error message.</p>
<p>To check the data availability, you can either use the <code><a href="../../reference/is.available_Comtrade.html">is.available_Comtrade()</a></code> function, or the data file <code>Comtrade_DA</code> which I am doing below. As you can see, at the time of writing this tutorial, the most recent monthly trade data is July 2021.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Comtrade_DA</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>yr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">ps</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span>, mnth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">ps</span>, <span class="fl">5</span>,<span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">freq</span> <span class="op">==</span> <span class="st">"MONTHLY"</span> <span class="op">&amp;</span> <span class="va">yr</span> <span class="op">==</span> <span class="st">'2021'</span> <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">mnth</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 x 1</span>
<span class="co">#&gt;   x    </span>
<span class="co">#&gt;   &lt;chr&gt;</span>
<span class="co">#&gt; 1 07</span></code></pre></div>
<p>The query for 2021 is identical to the first one with the exception of parameter <code>month = c(1:7)</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mirr_part2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/download_Comtrade.html">download_Comtrade</a></span><span class="op">(</span>
  year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2021"</span><span class="op">)</span>,
  frequency <span class="op">=</span> <span class="st">"monthly"</span>,
  month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span>,
  countries <span class="op">=</span> <span class="va">country_list</span>,
  partners <span class="op">=</span> <span class="st">"World"</span>,
  nomenclature <span class="op">=</span> <span class="st">"HS"</span>,
  commodity <span class="op">=</span> <span class="st">"ag6"</span>,
  select.stats <span class="op">=</span> <span class="st">"trade_value_usd"</span>,
  direction <span class="op">=</span> <span class="st">"all"</span>,
  type <span class="op">=</span> <span class="st">"commodities"</span>,
  is.mirrorData <span class="op">=</span> <span class="cn">TRUE</span>,
  rm.temporaryFiles <span class="op">=</span> <span class="cn">FALSE</span>,
  location.temporaryFiles <span class="op">=</span> <span class="va">my_location</span>,
  build.Comtrade <span class="op">=</span> <span class="cn">TRUE</span>,
  token <span class="op">=</span> <span class="va">my_token</span>,
  ext_cnt  <span class="op">=</span> <span class="fl">3</span>,
  sleep <span class="op">=</span> <span class="fl">10</span>
<span class="op">)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://amannj.github.io">Juergen Amann</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
