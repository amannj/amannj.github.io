<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working with mirror data • comtradeRggregator</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Working with mirror data">
<meta property="og:description" content="comtradeRggregator">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">comtradeRggregator</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../articles/comtradeRggregator.html">Get started</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/articles/chaining-concordance-tables.html">Chaining concordance tables</a>
    </li>
    <li>
      <a href="../../articles/articles/extracting-aggregates.html">Extracting aggregated trade data</a>
    </li>
    <li>
      <a href="../../articles/articles/handling-errors.html">Handling error messages</a>
    </li>
    <li>
      <a href="../../articles/articles/mirror-data.html">Working with mirror data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/amannj/comtradeRggregator/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Mirror-data_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Working with mirror data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/amannj/comtradeRggregator/blob/master/vignettes/articles/mirror-data.Rmd"><code>vignettes/articles/mirror-data.Rmd</code></a></small>
      <div class="hidden name"><code>mirror-data.Rmd</code></div>

    </div>

    
    
<div id="what-is-mirror-data-and-why-use-it" class="section level2">
<h2 class="hasAnchor">
<a href="#what-is-mirror-data-and-why-use-it" class="anchor"></a>What is mirror data and why use it?</h2>
<p>Consider the case where country A does not report any trade data at all. What do we do? In such cases it makes sense to use <a href="https://wits.worldbank.org/wits/wits/witshelp/Content/Data_Retrieval/T/Intro/B2.Imports_Exports_and_Mirror.htm">mirrored trade data</a>. In a nutshell, using the mirrored data approach we can reconstruct trade data for country A, even if the country itself does not report andy trade figures, by looking at all trade flows in which country A participated. For example, you can reconstruct country A’s exports to country B by looking at country B’s imports from country A.</p>
<p>Do note, however, that this method is not free of limitations. Most importantly, the reliability of the mirrored trade data for country A depends on the data availability of trade data made available by A’s trading partners and may potentially be systematically biased. Secondly, as comtrade trade data undergoes constant revisions and updates, changes in the mirrored aggregate are more likely than with non-mirrored data.</p>
<p>These words of caution aside, the function <code><a href="../../reference/download_Comtrade.html">download_Comtrade()</a></code> offers an easy option perform mirror data extracts. Below, we first revisit <a href="https://amannj.github.io/resources/comtradeRggregator/articles/comtradeRggregator.html#example-4">Example 4</a> from the <em>Get Started guide</em> provides a simple introduction to this topic. Next, we turn to somewhat more involved user cases.</p>
</div>
<div id="a-simple-example" class="section level2">
<h2 class="hasAnchor">
<a href="#a-simple-example" class="anchor"></a>A simple example</h2>
<p>First, load the package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/amannj/comtradeRggregator">comtradeRggregator</a></span><span class="op">)</span></code></pre></div>
<p>In <a href="https://amannj.github.io/resources/comtradeRggregator/articles/comtradeRggregator.html#example-4">Example 4</a> we reconstructed Austria’s export to Germany by looking at Germany’s imports from Austria by setting <code>is.mirrorData = TRUE</code>. As you can see, variable <code>reporter</code> now is returned as <code>country name + "mirrored"</code>, indicating that the the data was derived from a mirrored data query.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mirrX_AT_DE</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/download_Comtrade.html">download_Comtrade</a></span><span class="op">(</span>
  year <span class="op">=</span> <span class="st">"2018"</span>,
  frequency <span class="op">=</span> <span class="st">"annual"</span>,
  countries <span class="op">=</span> <span class="st">"Austria"</span>,
  partners <span class="op">=</span> <span class="st">"Germany"</span>,
  nomenclature <span class="op">=</span> <span class="st">"H3"</span>,
  commodity <span class="op">=</span> <span class="st">"ag6"</span>,
  select.stats <span class="op">=</span> <span class="st">"trade_value_usd"</span>,
  direction <span class="op">=</span> <span class="st">"exports"</span>,
  type <span class="op">=</span> <span class="st">"commodities"</span>,
  is.mirrorData <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>
<span class="va">mirrX_AT_DE</span>
<span class="co">#&gt; # A tibble: 4,056 x 8</span>
<span class="co">#&gt;    classification period trade_flow reporter         partner commodity_code commodity          trade_value_usd</span>
<span class="co">#&gt;    &lt;chr&gt;           &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;            &lt;chr&gt;   &lt;chr&gt;          &lt;chr&gt;                        &lt;dbl&gt;</span>
<span class="co">#&gt;  1 H3               2018 Export     Austria mirrored Germany 010110         Live horses/asses~          578079</span>
<span class="co">#&gt;  2 H3               2018 Export     Austria mirrored Germany 010190         Live horses/asses~           17717</span>
<span class="co">#&gt;  3 H3               2018 Export     Austria mirrored Germany 010210         Live bovine anima~           75642</span>
<span class="co">#&gt;  4 H3               2018 Export     Austria mirrored Germany 010290         Live bovine anima~         4329765</span>
<span class="co">#&gt;  5 H3               2018 Export     Austria mirrored Germany 010391         Live swine other ~          916695</span>
<span class="co">#&gt;  6 H3               2018 Export     Austria mirrored Germany 010392         Live swine other ~          219879</span>
<span class="co">#&gt;  7 H3               2018 Export     Austria mirrored Germany 010410         Live sheep                  778978</span>
<span class="co">#&gt;  8 H3               2018 Export     Austria mirrored Germany 010420         Live goats                   45964</span>
<span class="co">#&gt;  9 H3               2018 Export     Austria mirrored Germany 010511         Live fowls of spe~         6716350</span>
<span class="co">#&gt; 10 H3               2018 Export     Austria mirrored Germany 010512         Live turkeys, wei~            2194</span>
<span class="co">#&gt; # ... with 4,046 more rows</span></code></pre></div>
<p>Conceptually, reported imports by Germany from Austria and reported mirrored exports by Austria to Germany are identical by definition. Note that in the query below we can use either <code>tradecode</code> names or abbreviations as input arguments for <code>tradecode</code> as provided in table <a href="https://amannj.github.io/resources/comtradeRggregator/index.html#trade-classifications">Trade Classifications</a>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">IM_DE_AT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/download_Comtrade.html">download_Comtrade</a></span><span class="op">(</span>
  year <span class="op">=</span> <span class="st">"2018"</span>,
  frequency <span class="op">=</span> <span class="st">"annual"</span>,
  countries <span class="op">=</span> <span class="st">"Germany"</span>,
  partners <span class="op">=</span> <span class="st">"Austria"</span>,
  nomenclature <span class="op">=</span> <span class="st">"HS2007"</span>,
  commodity <span class="op">=</span> <span class="st">"ag6"</span>,
  select.stats <span class="op">=</span> <span class="st">"trade_value_usd"</span>,
  direction <span class="op">=</span> <span class="st">"imports"</span>,
  type <span class="op">=</span> <span class="st">"commodities"</span>,
  is.mirrorData <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span>
<span class="va">IM_DE_AT</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">trade_value_usd</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="op">)</span> <span class="op">/</span> <span class="va">mirrX_AT_DE</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">trade_value_usd</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] 1</span></code></pre></div>
</div>
<div id="generating-mirrored-world-trad-data" class="section level2">
<h2 class="hasAnchor">
<a href="#generating-mirrored-world-trad-data" class="anchor"></a>Generating mirrored World trad data</h2>
<p><code>comtradeRggregator</code> also offers simple options to download mirrored global trade data by downloading mirrored bilateral trade flows and aggregating it up to mirrored global trade data. In the simple example below, we download mirrored trade data for Austria. By setting <code>countries = "World"</code>, the package will create a mirrored data query for all global economies for the provided specification of year, trade flow, nomenclature, level of aggregation etc., and create a ready-to-use data frame.</p>
<p>In other words, to get the first mirrored export commodity flow for commodity group <code>01 - Live animals; animal products</code> in the query below, data from all countries that <em>import</em> this commodity from Austria are queried and aggregated. Then, when aggregating the final data set, the ‘order’ of the trade flows is reversed, i.e. the previously downloaded <em>imports</em> are labelled as <em>mirrored exports</em>. This reversal is highlighted in column <code>reporter</code>.</p>
<p>In elaborate cases such as the one above it is advisable to keep any temporarily downloaded data by setting <code>rm.temporaryFiles = FALSE</code>, and, ideally, to have access to an authenticated account; see <a href="https://comtrade.un.org/data/doc/api/">here</a> for more information.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">AT_mirr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/download_Comtrade.html">download_Comtrade</a></span><span class="op">(</span>
  year <span class="op">=</span> <span class="st">"2018"</span>,
  frequency <span class="op">=</span> <span class="st">"annual"</span>,
  countries <span class="op">=</span> <span class="st">"Austria"</span>,
  partners <span class="op">=</span> <span class="st">"World"</span>,
  nomenclature <span class="op">=</span> <span class="st">"HS2007"</span>,
  commodity <span class="op">=</span> <span class="st">"ag2"</span>,
  select.stats <span class="op">=</span> <span class="st">"trade_value_usd"</span>,
  direction <span class="op">=</span> <span class="st">"all"</span>,
  type <span class="op">=</span> <span class="st">"commodities"</span>,
  is.mirrorData <span class="op">=</span> <span class="cn">TRUE</span>,
  rm.temporaryFiles <span class="op">=</span> <span class="cn">FALSE</span>,
  build.Comtrade <span class="op">=</span> <span class="cn">TRUE</span>,
<span class="op">)</span>
<span class="va">AT_mirr</span>
<span class="co">#&gt; # A tibble: 363 x 8</span>
<span class="co">#&gt;    classification period trade_flow reporter         partner commodity_code commodity    ~ trade_value_usd</span>
<span class="co">#&gt;    &lt;chr&gt;           &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;            &lt;chr&gt;   &lt;chr&gt;          &lt;chr&gt;        ~           &lt;dbl&gt;</span>
<span class="co">#&gt;  1 H3               2018 Export     Austria mirrored World   01             Live animals;~       146122111</span>
<span class="co">#&gt;  2 H3               2018 Export     Austria mirrored World   02             Meat and edib~      1279494900</span>
<span class="co">#&gt;  3 H3               2018 Export     Austria mirrored World   03             Fish and crus~        10067362</span>
<span class="co">#&gt;  4 H3               2018 Export     Austria mirrored World   04             Dairy produce~      1522685531</span>
<span class="co">#&gt;  5 H3               2018 Export     Austria mirrored World   05             Products of a~        79271602</span>
<span class="co">#&gt;  6 H3               2018 Export     Austria mirrored World   06             Live trees an~        26938801</span>
<span class="co">#&gt;  7 H3               2018 Export     Austria mirrored World   07             Edible vegeta~       142130800</span>
<span class="co">#&gt;  8 H3               2018 Export     Austria mirrored World   08             Edible fruit ~       209962703</span>
<span class="co">#&gt;  9 H3               2018 Export     Austria mirrored World   09             Coffee, tea, ~       116804431</span>
<span class="co">#&gt; 10 H3               2018 Export     Austria mirrored World   10             Cereals      ~       544971227</span>
<span class="co">#&gt; # ... with 353 more rows</span></code></pre></div>
</div>
<div id="a-more-complex-application" class="section level2">
<h2 class="hasAnchor">
<a href="#a-more-complex-application" class="anchor"></a>A more complex application</h2>
<div id="the-problem" class="section level3">
<h3 class="hasAnchor">
<a href="#the-problem" class="anchor"></a>The problem</h3>
<p>Let’s say you want to download monthly mirror trade data starting in 2019 at the HS 6-digit level for a handful of countries for which there is no trade data available on <a href="https://comtrade.un.org/">comtrade</a>.</p>
<p>While there are multiple areas where both <a href="https://comtrade.un.org/">comtrade</a> and <a href="https://wits.worldbank.org/">WITS</a> offer similar functionality to the <code>comtradeRggregator</code> package, this is a scenario where both alternatives are tedious to work with:</p>
<ul>
<li><p><a href="https://wits.worldbank.org/">WITS</a> does offer a straight-forward integration of mirror data, but there are (at the time of writing this documentation in 2021) no options available to query monthly data;</p></li>
<li><p><a href="https://comtrade.un.org/">Comtrade</a> does over the most recent and granular trade data, but there is no option to query mirror data.</p></li>
</ul>
<p>Using <code>comtradeRggregator</code>, the this query can be put together with a couple of line sof code.</p>
</div>
<div id="the-implementation-in-comtraderggregator" class="section level3">
<h3 class="hasAnchor">
<a href="#the-implementation-in-comtraderggregator" class="anchor"></a>The implementation in <code>comtradeRggregator</code>
</h3>
<p>First, we want to define list of countries for extraction. The two examples we use here are <em>Afghanistan</em> and the <em>Democratic Republic of the Congo</em>. To double-check the correct spelling of the country names we use <code><a href="../../reference/is.available_Comtrade.html">is.available_Comtrade()</a></code> with option <code>is.fuzzy = TRUE</code>. Below I run the check for the <em>Democratic Republic of the Congo</em> only. However, for large queries it is advisable to double-check that all country names are correct before setting up the actual data query. If you don’t do that, and are unlucky in the sense that a particular country name is spelled differently in <a href="https://comtrade.un.org/">comtrade</a>, your data query will return an error.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../../reference/is.available_Comtrade.html">is.available_Comtrade</a></span><span class="op">(</span>
  is.contained <span class="op">=</span> <span class="st">"Congo"</span>,
  is.fuzzy <span class="op">=</span> <span class="cn">TRUE</span>,
  frequency <span class="op">=</span> <span class="st">"annual"</span>,
  nomenclature <span class="op">=</span> <span class="st">"HS"</span>,
  year <span class="op">=</span> <span class="st">'2019'</span>
<span class="op">)</span>
<span class="co">#&gt; # A tibble: 2 x 2</span>
<span class="co">#&gt;   country                 year</span>
<span class="co">#&gt;   &lt;chr&gt;                  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Dem. Rep. of the Congo  2019</span>
<span class="co">#&gt; 2 Congo                   2019</span></code></pre></div>
<p>The final list of countries we want to query is:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">country_list</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Afghanistan"</span>, <span class="st">"Dem. Rep. of the Congo"</span><span class="op">)</span></code></pre></div>
<p>When setting up this more elaborate query, there are a few things we should keep in mind:</p>
<ul>
<li><p>It makes sense to break up this query into two parts: a download for the years 2019 and 2020, and a separate query for 2021. The reason for this is that at the time of writing this tutorial, trade data for all 12 months was available for 2019 and 2020, but not for 2021 as this would make <code><a href="../../reference/download_Comtrade.html">download_Comtrade()</a></code> throw an error message.</p></li>
<li><p>It is advisable to keep any temporarily downloaded data by setting <code>rm.temporaryFiles = FALSE</code>. I also want to save the temporary files in a different location specified in variable <code>my_location</code>, so I also specify <code>location.temporaryFiles = my_location</code> in the query below.</p></li>
<li><p>In an ideal world, you will have access to an authenticated account <a href="https://comtrade.un.org/data/doc/api/">(see here)</a>. I do, so I’m also providing my <a href="https://comtrade.un.org/">comtrade</a> authentication token as part of the query.</p></li>
<li><p>Note that for the first query we are not specifying the parameter <code>month</code> which, by default, will return data for all 12 months. Also, note that monthly <a href="https://comtrade.un.org/">comtrade</a> data is only available following the <em>HS combined nomenclature</em>.</p></li>
<li><p>Finally, as we do not want to overwhelm the API, we reduce the number of extracted countries per sub-query to three, i.e. <code>ext_cnt  = 3</code>, instead of the default of five, and increase the cool-down period between the separate queries from five to ten seconds between rounds by setting <code>speed = 10</code>. These last two steps are optional and only serve illustrative purposes.</p></li>
</ul>
<p>With all of this out of the way, the final monthly mirror data query for 2019 and 2020 looks like this:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mirr_part1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/download_Comtrade.html">download_Comtrade</a></span><span class="op">(</span>
  year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2019"</span>, <span class="st">"2020"</span><span class="op">)</span>,
  frequency <span class="op">=</span> <span class="st">"monthly"</span>,
  countries <span class="op">=</span> <span class="va">country_list</span>,
  partners <span class="op">=</span> <span class="st">"World"</span>,
  nomenclature <span class="op">=</span> <span class="st">"HS"</span>,
  commodity <span class="op">=</span> <span class="st">"ag6"</span>,
  select.stats <span class="op">=</span> <span class="st">"trade_value_usd"</span>,
  direction <span class="op">=</span> <span class="st">"all"</span>,
  type <span class="op">=</span> <span class="st">"commodities"</span>,
  is.mirrorData <span class="op">=</span> <span class="cn">TRUE</span>,
  rm.temporaryFiles <span class="op">=</span> <span class="cn">FALSE</span>,
  location.temporaryFiles <span class="op">=</span> <span class="va">my_location</span>,
  build.Comtrade <span class="op">=</span> <span class="cn">TRUE</span>,
  token <span class="op">=</span> <span class="va">my_token</span>,
  ext_cnt  <span class="op">=</span> <span class="fl">3</span>,
  sleep <span class="op">=</span> <span class="fl">10</span>
<span class="op">)</span></code></pre></div>
<p>For the 2021 query, we first want to find the last month of 2021 for which trade data is available. This makes sense because we do not want to run a query for a month where no trade data is available as this would make <code><a href="../../reference/download_Comtrade.html">download_Comtrade()</a></code> throw an error message.</p>
<p>To check the data availability, you can either use the <code><a href="../../reference/is.available_Comtrade.html">is.available_Comtrade()</a></code> function, or the data file <code>Comtrade_DA</code> which I am doing below. As you can see, at the time of writing this tutorial, the most recent monthly trade data is July 2021.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Comtrade_DA</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>yr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">ps</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span>, mnth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">ps</span>, <span class="fl">5</span>,<span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">freq</span> <span class="op">==</span> <span class="st">"MONTHLY"</span> <span class="op">&amp;</span> <span class="va">yr</span> <span class="op">==</span> <span class="st">'2021'</span> <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">mnth</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 x 1</span>
<span class="co">#&gt;   x    </span>
<span class="co">#&gt;   &lt;chr&gt;</span>
<span class="co">#&gt; 1 09</span></code></pre></div>
<p>The query for 2021 is identical to the first one with the exception of parameter <code>month = c(1:7)</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mirr_part2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/download_Comtrade.html">download_Comtrade</a></span><span class="op">(</span>
  year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2021"</span><span class="op">)</span>,
  frequency <span class="op">=</span> <span class="st">"monthly"</span>,
  month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span>,
  countries <span class="op">=</span> <span class="va">country_list</span>,
  partners <span class="op">=</span> <span class="st">"World"</span>,
  nomenclature <span class="op">=</span> <span class="st">"HS"</span>,
  commodity <span class="op">=</span> <span class="st">"ag6"</span>,
  select.stats <span class="op">=</span> <span class="st">"trade_value_usd"</span>,
  direction <span class="op">=</span> <span class="st">"all"</span>,
  type <span class="op">=</span> <span class="st">"commodities"</span>,
  is.mirrorData <span class="op">=</span> <span class="cn">TRUE</span>,
  rm.temporaryFiles <span class="op">=</span> <span class="cn">FALSE</span>,
  location.temporaryFiles <span class="op">=</span> <span class="va">my_location</span>,
  build.Comtrade <span class="op">=</span> <span class="cn">TRUE</span>,
  token <span class="op">=</span> <span class="va">my_token</span>,
  ext_cnt  <span class="op">=</span> <span class="fl">3</span>,
  sleep <span class="op">=</span> <span class="fl">10</span>
<span class="op">)</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://amannj.github.io">Juergen Amann</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
